<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">

<dom-module id="user-toolbar">
    <style>
        :host {
            display: inline-block;
        }

        #spinner {
            vertical-align: middle;
        }
    </style>
    <template>
        <paper-spinner active id="spinner" alt="Loading"></paper-spinner>
        <span>[[greeting]]</span>
        <paper-icon-button icon="eject" title="Logout" on-click="logout"></paper-icon-button>
    </template>

    <script>
        (function () {

            "use strict";
            Polymer({
                is: 'user-toolbar',

                properties: {
                    greeting: String
                },

                attached: function () {
                    var user = JSON.parse(window.localStorage.getItem('user'));
                    this.greeting = "Hi, " + user.firstName;
                    window.addEventListener('xhr-requested', this.showSpinner.bind(this));
                },

                showSpinner: function (e) {
                    this.$.spinner.active = e.detail.isLoading;
                },

                detached: function () {
                    window.removeEventListener('xhr-requested');
                },

                logout: function () {

                    var url = window.global.config.apiroot + "/auth/logout";
                    axios.get(url).then(function (result) {
                        window.localStorage.removeItem('user');
                        window.localStorage.removeItem('auth');
                        window.location = "./login.html";
                    });
                }

            });
        })();
    </script>

</dom-module>

