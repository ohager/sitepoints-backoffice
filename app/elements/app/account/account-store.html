<script>
    (function () {
        "use strict";
        NanoFlux.createStore('accountStore', {
            _account: {},
            onAddDomain: function (domainName) {
                if (this._account.domains && this._account.domains.indexOf(domainName) === -1) {

                    this._account.domains.push(domainName);
                    this.notify(this._account);
                }
            },
            onRemoveDomain: function (domainName) {
                if (this._account.domains) {
                    var dix = this._account.domains.indexOf(domainName);
                    if(dix!==-1){
                        this._account.domains.splice(dix, 1);
                        this.notify(this._account);
                    }
                }
            },

            onLoad: function () {
                var user = JSON.parse(window.localStorage.getItem('user'));
                var restapi = fermata.json(window.global.config.apiroot);
                restapi('account')(user.user).get(function (error, result) {
                    this._account = result;
                    // TODO: multiple domains in backend
                    this._account.domains = [];
                    this._account.domains.push(result.domain);
                    this.notify(this._account);
                }.bind(this));
            }


        });
    })()
</script>
