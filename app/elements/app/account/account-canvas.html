<link rel="import" href="../../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../../bower_components/paper-ripple/paper-ripple.html">
<link rel="import" href="../../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../bower_components/iron-fit-behavior/iron-fit-behavior.html">
<link rel="import" href="../../../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="account-item.html">
<link rel="import" href="account-domains-card.html">


<dom-module id="account-canvas">
    <style>
        :host {
            display: block;

        }

        #cards {
        @apply(- -layout-vertical);
        @apply(- -center-justified);
            max-width: 640px;
            margin-left: auto;
            margin-right: auto;
        }

        paper-card {
            width: 100%;
            margin-bottom: 16px;
        }

        .list {
            padding-top: 12px;
            background-color: white;
            display: inline-block;
            width: 240px;
            height: 228px;
            margin: 12px;
        @apply(- -shadow-elevation-2dp);
        }

        .short {
            padding-top: 12px;
            height: 216px;
        }



        .lime {
            --account-item-avatar-color: #CDDC39;
        }

        .brown {
            --account-item-avatar-color: #795548;
        }

        .amber {
            --account-item-avatar-color: #FFC107;
        }


        small {
            color: grey;
        }

        .action-content {
            text-align: center;
            padding: 16px;
            cursor: pointer;
        }

        .custom-fab{
            position: absolute;
            z-index : 100;
        }

        paper-fab::shadow > paper-material {
            @apply(--shadow-elevation-2dp);
        }

        paper-fab::shadow > paper-material:hover {
            @apply(--shadow-elevation-6dp);
        }

        #toast {
            position : absolute;
        }


        .custom-fab.green {
            --paper-fab-background: var(--paper-green-500);
            --paper-fab-keyboard-focus-background: var(--paper-green-900);

        }

        .custom-fab.blue {
            --paper-fab-background: var(--paper-grey-500);
            --paper-fab-keyboard-focus-background: var(--paper-grey-900);
        }

        .custom-fab.indent {
            margin-top : 5em;
            margin-left : 0.5em;
        }


    </style>
    <template>

        <paper-fab icon="done" title="Save Changes" class="custom-fab green" on-click="save" elevation="4"></paper-fab>
        <paper-fab mini icon="autorenew" title="Reload" class="custom-fab blue indent" on-click="reload" elevation="4"></paper-fab>

        <div id="cards">


            <paper-card heading="API Key">
                <div class="card-content">
                    <code>[[account.apikey]]</code>
                </div>
            </paper-card>

            <paper-card heading="This is you!">
                <div class="card-content">
                    <div role="list">
                        <account-item label="User Name" class="amber" value="[[account.user]]"></account-item>
                        <account-item label="First Name" class="brown" value="{{account.firstName}}" editable></account-item>
                        <account-item label="Last Name" class="lime" value="{{account.lastName}}" editable></account-item>
                    </div>
                </div>
            </paper-card>

           <account-domains-card></account-domains-card>
        </div>

        <paper-toast id="toast" text="[[toastMessage]]"></paper-toast>
    </template>

    <script>
        (function () {

            "use strict";
            Polymer({
                is: 'account-canvas',

                properties: {
                    account: Object,
                    editorStateLastName: {
                        type: Boolean,
                        value: false
                    },
                    toastMessage: String
                },


                save : function(){
                    NanoFlux.accountActions.save(this.account).then(function(){
                        this.toastMessage = "Yeah, account updated!";
                        this.$.toast.show();
                    }.bind(this)).catch(function(){
                        this.toastMessage = "F*#!, update screwed up!";
                        this.$.toast.show();
                        this.reload();
                    }.bind(this));
                },

                reload : function(){
                    NanoFlux.accountActions.load();
                },

                edit: function (event) {
                    var id = event.target.domHost.id;

                    this.editorStateLastName = true;
                },

                accountChanged: function (account) {
                    this.account = account;
                },

                ready: function () {
                    var store = NanoFlux.getStore('accountStore');
                    store.subscribe(this, this.accountChanged);
                },

                attached : function(){
                    this.reload();
                }

            });
        })();
    </script>

</dom-module>

