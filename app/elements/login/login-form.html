<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">


<dom-module id="login-form">
    <style>
        :host {
            display: block;
        }

        .colorful {
            background-color: #4285f4;
            color: #fff;
        }

        .centered-button-box {
            display: inline-block;
            margin: 0 auto;
            padding-top: 1em;
            text-align: center;
        }

        .message {
            margin-top: 0.5em;
            color: #e81719;
            font-size: 10px;
            text-align: center;
        }

    </style>
    <template>
        <div class="message">
            <label>[[loginMessage]]</label>
        </div>
        <form is="iron-form" id="form">
            <paper-input id="username" label="Username" value="{{user}}"></paper-input>
            <paper-input type="password" id="password" label="Password"></paper-input>
            <div class="centered-button-box">
                <paper-button raised role="button" on-click="register">
                    <iron-icon icon="create"></iron-icon>
                    Register
                </paper-button>
                <paper-button raised role="button" class="colorful" on-click="login">
                    <iron-icon icon="check"></iron-icon>
                    Login
                </paper-button>
            </div>
        </form>
    </template>

    <script>
        (function () {

            "use strict";
            Polymer({
                is: 'login-form',

                properties: {
                    loginMessage: String,
                    user : String
                },

                login: function () {

                    var restapi = fermata.raw({base: window.global.config.apiroot});
                    restapi('backoffice')('login').post( { 'Content-Type' :'application/json'}, JSON.stringify({
                        user: this.$.username.value,
                        password: this.$.password.value
                    }), function (error, result) {
                        var data = result.data;
                        if (result.status === 200) {
                            window.localStorage.setItem('user',data);
                            window.localStorage.setItem('auth', result.headers['X-Authorization']);
                            window.location.href = "index.html";
                        }
                        else {
                            this.loginMessage = data;
                        }
                    }.bind(this));

                },

                register : function(){
                    page('/register');
                }
            });
        })();
    </script>

</dom-module>

